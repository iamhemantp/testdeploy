"use strict";(self.webpackChunkabp_zero_template=self.webpackChunkabp_zero_template||[]).push([[26709],{26709:(We,M,d)=>{d.r(M),d.d(M,{OrganizationUnitsModule:()=>Ke});var a=d(81180),A=d(12236),I=d(47530),h=d(41840),e=d(99468),u=d(96814),y=d(14647),S=d(68989),c=d(44328),O=d(43136),H=d(66232),w=d(58504),L=d(26306),J=d(78164),P=d(98833),D=d(76388),T=d(85219),Q=d(91396),q=d(48493),f=d(64716),p=d(56223),Z=d(45513),G=d(42152),U=d(24142),_=d(3291);const E=["createOrEditModal"],F=["organizationUnitDisplayName"];function j(o,r){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"localize"),e.qZA()),2&o){const l=e.oxw(2);e.xp6(1),e.AsE(" ",e.lcZ(2,2,"Edit"),": ",l.organizationUnit.displayName," ")}}function Y(o,r){1&o&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"localize"),e.qZA()),2&o&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"NewOrganizationUnit")))}const k=function(o){return{edited:o}};function B(o,r){if(1&o){const l=e.EpF();e.TgZ(0,"form",5,6),e.NdJ("ngSubmit",function(){e.CHM(l);const t=e.oxw();return e.KtG(t.save())}),e.TgZ(2,"div",7)(3,"h5",8),e.YNc(4,j,3,4,"span",9),e.YNc(5,Y,3,3,"span",9),e.qZA(),e.TgZ(6,"button",10),e.NdJ("click",function(){e.CHM(l);const t=e.oxw();return e.KtG(t.close())}),e.qZA()(),e.TgZ(7,"div",11)(8,"div",12)(9,"label",13),e._uU(10),e.ALo(11,"localize"),e.qZA(),e.TgZ(12,"input",14,15),e.NdJ("ngModelChange",function(t){e.CHM(l);const i=e.oxw();return e.KtG(i.organizationUnit.displayName=t)}),e.qZA(),e._UZ(14,"validation-messages",16),e.qZA()(),e.TgZ(15,"div",17)(16,"button",18),e.NdJ("click",function(){e.CHM(l);const t=e.oxw();return e.KtG(t.close())}),e._uU(17),e.ALo(18,"localize"),e.qZA(),e.TgZ(19,"button",19),e._UZ(20,"i",20),e.TgZ(21,"span"),e._uU(22),e.ALo(23,"localize"),e.qZA()()()()}if(2&o){const l=e.MAs(1),n=e.MAs(13),t=e.oxw();e.xp6(4),e.Q6J("ngIf",t.organizationUnit.id),e.xp6(1),e.Q6J("ngIf",!t.organizationUnit.id),e.xp6(1),e.Q6J("disabled",t.saving),e.uIk("aria-label",t.l("Close")),e.xp6(4),e.hij("",e.lcZ(11,14,"Name")," *"),e.xp6(2),e.Q6J("ngClass",e.VKq(20,k,t.organizationUnit.displayName))("ngModel",t.organizationUnit.displayName),e.xp6(2),e.Q6J("formCtrl",n),e.xp6(2),e.Q6J("disabled",t.saving),e.xp6(1),e.hij(" ",e.lcZ(18,16,"Cancel")," "),e.xp6(2),e.Q6J("disabled",!l.form.valid)("buttonBusy",t.saving)("busyText",t.l("SavingWithThreeDot")),e.xp6(3),e.Oqu(e.lcZ(23,18,"Save"))}}const K=function(o){return{backdrop:"static",keyboard:o}};let W=(()=>{var o;class r extends h.c{constructor(n,t,i){super(n),(0,a.Z)(this,"_organizationUnitService",void 0),(0,a.Z)(this,"_changeDetector",void 0),(0,a.Z)(this,"modal",void 0),(0,a.Z)(this,"organizationUnitDisplayNameInput",void 0),(0,a.Z)(this,"unitCreated",new e.vpe),(0,a.Z)(this,"unitUpdated",new e.vpe),(0,a.Z)(this,"active",!1),(0,a.Z)(this,"saving",!1),(0,a.Z)(this,"organizationUnit",{}),this._organizationUnitService=t,this._changeDetector=i}onShown(){document.getElementById("OrganizationUnitDisplayName").focus()}show(n){this.organizationUnit=n,this.active=!0,this.modal.show(),this._changeDetector.detectChanges()}save(){this.organizationUnit.id?this.updateUnit():this.createUnit()}createUnit(){const n=new c.DIt;n.parentId=this.organizationUnit.parentId,n.displayName=this.organizationUnit.displayName,this.saving=!0,this._organizationUnitService.createOrganizationUnit(n).pipe((0,f.x)(()=>this.saving=!1)).subscribe(t=>{this.notify.info(this.l("SavedSuccessfully")),this.close(),this.unitCreated.emit(t)})}updateUnit(){const n=new c.cOS;n.id=this.organizationUnit.id,n.displayName=this.organizationUnit.displayName,this.saving=!0,this._organizationUnitService.updateOrganizationUnit(n).pipe((0,f.x)(()=>this.saving=!1)).subscribe(t=>{this.notify.info(this.l("SavedSuccessfully")),this.close(),this.unitUpdated.emit(t)})}close(){this.modal.hide(),this.active=!1}}return o=r,(0,a.Z)(r,"\u0275fac",function(n){return new(n||o)(e.Y36(e.zs3),e.Y36(c.OAl),e.Y36(e.sBO))}),(0,a.Z)(r,"\u0275cmp",e.Xpm({type:o,selectors:[["createOrEditOrganizationUnitModal"]],viewQuery:function(n,t){if(1&n&&(e.Gf(E,7),e.Gf(F,7)),2&n){let i;e.iGM(i=e.CRH())&&(t.modal=i.first),e.iGM(i=e.CRH())&&(t.organizationUnitDisplayNameInput=i.first)}},outputs:{unitCreated:"unitCreated",unitUpdated:"unitUpdated"},features:[e.qOj],decls:5,vars:4,consts:[["appBsModal","","tabindex","-1","role","dialog","aria-labelledby","createOrEditModal","aria-hidden","true",1,"modal","fade",3,"config","onShown"],["createOrEditModal","bs-modal"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],["novalidate","",3,"ngSubmit",4,"ngIf"],["novalidate","",3,"ngSubmit"],["editForm","ngForm"],[1,"modal-header"],[1,"modal-title"],[4,"ngIf"],["type","button",1,"btn-close",3,"disabled","click"],[1,"modal-body"],[1,"mb-5","form-md-line-input","form-md-floating-label","no-hint"],["for","OrganizationUnitDisplayName",1,"form-label"],["id","OrganizationUnitDisplayName","type","text","name","displayName","required","","maxlength","128",1,"form-control",3,"ngClass","ngModel","ngModelChange"],["organizationUnitDisplayName","ngModel"],[3,"formCtrl"],[1,"modal-footer"],["type","button",1,"btn","btn-light-primary","fw-bold",3,"disabled","click"],["type","submit",1,"btn","btn-primary","fw-bold",3,"disabled","buttonBusy","busyText"],[1,"fa","fa-save"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0,1),e.NdJ("onShown",function(){return t.onShown()}),e.TgZ(2,"div",2)(3,"div",3),e.YNc(4,B,24,22,"form",4),e.qZA()()()),2&n&&(e.Q6J("config",e.VKq(2,K,!t.saving)),e.xp6(4),e.Q6J("ngIf",t.active))},dependencies:[u.mk,u.O5,p._Y,p.Fj,p.JJ,p.JL,p.Q7,p.nD,p.On,p.F,Z.L,G.s,U.Z,_.F],encapsulation:2})),r})();var v=d(83410);const $=["createOrEditOrganizationUnitModal"],X=["entityTypeHistoryModal"];function V(o,r){if(1&o){const l=e.EpF();e.TgZ(0,"button",15),e.NdJ("click",function(){e.CHM(l);const t=e.oxw();return e.KtG(t.addUnit(null))}),e._UZ(1,"i",16),e.TgZ(2,"span",17),e._uU(3),e.ALo(4,"localize"),e.qZA()()}2&o&&(e.xp6(3),e.hij(" ",e.lcZ(4,1,"AddRootUnit")," "))}function ee(o,r){if(1&o&&(e.TgZ(0,"div")(1,"span"),e._uU(2),e.qZA(),e.TgZ(3,"small",18),e._uU(4),e.ALo(5,"localize"),e.ALo(6,"localize"),e.qZA()()),2&o){const l=r.$implicit;e.xp6(2),e.hij(" ",l.label," "),e.xp6(2),e.HOy(" ",l.memberCount," ",e.lcZ(5,5,"Members"),", ",l.roleCount," ",e.lcZ(6,7,"Roles")," ")}}function te(o,r){1&o&&(e.TgZ(0,"div",19),e._uU(1),e.ALo(2,"localize"),e.qZA()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"NoOrganizationUnitDefinedYet")," "))}let ne=(()=>{var o;class r extends h.c{constructor(n,t,i,s){super(n),(0,a.Z)(this,"_organizationUnitService",void 0),(0,a.Z)(this,"_arrayToTreeConverterService",void 0),(0,a.Z)(this,"_treeDataHelperService",void 0),(0,a.Z)(this,"ouSelected",new e.vpe),(0,a.Z)(this,"createOrEditOrganizationUnitModal",void 0),(0,a.Z)(this,"entityTypeHistoryModal",void 0),(0,a.Z)(this,"treeData",void 0),(0,a.Z)(this,"selectedOu",void 0),(0,a.Z)(this,"ouContextMenuItems",void 0),(0,a.Z)(this,"canManageOrganizationUnits",!1),(0,a.Z)(this,"totalUnitCount",0),(0,a.Z)(this,"_entityTypeFullName","Abp.Organizations.OrganizationUnit"),this._organizationUnitService=t,this._arrayToTreeConverterService=i,this._treeDataHelperService=s}ngOnInit(){this.canManageOrganizationUnits=this.isGranted("Pages.Administration.OrganizationUnits.ManageOrganizationTree"),this.ouContextMenuItems=this.getContextMenuItems(),this.getTreeDataFromServer()}nodeSelect(n){this.ouSelected.emit({id:n.node.data.id,displayName:n.node.data.displayName})}isDroppingBetweenTwoNodes(n){return"LI"===n.originalEvent.target.nodeName}nodeDrop(n){const t=new c.u6;t.id=n.dragNode.data.id;let i="";this.isDroppingBetweenTwoNodes(n)?(t.newParentId=n.dropNode.parent?n.dropNode.parent.data.id:null,i=n.dropNode.parent?n.dropNode.parent.data.displayName:this.l("Root")):(t.newParentId=n.dropNode.data.id,i=n.dropNode.data.displayName),this.message.confirm(this.l("OrganizationUnitMoveConfirmMessage",n.dragNode.data.displayName,i),this.l("AreYouSure"),s=>{s?this._organizationUnitService.moveOrganizationUnit(t).pipe((0,L.K)(g=>(this.revertDragDrop(),(0,w._)(g)))).subscribe(()=>{this.notify.success(this.l("SuccessfullyMoved")),this.reload()}):this.revertDragDrop()})}revertDragDrop(){this.reload()}reload(){this.getTreeDataFromServer()}addUnit(n){this.createOrEditOrganizationUnitModal.show({parentId:n})}unitCreated(n){if(n.parentId){let t=this._treeDataHelperService.findNode(this.treeData,{data:{id:n.parentId}});if(!t)return;t.children.push({label:n.displayName,expandedIcon:"fa fa-folder-open text-warning",collapsedIcon:"fa fa-folder text-warning",selected:!0,children:[],data:n,memberCount:n.memberCount,roleCount:n.roleCount})}else this.treeData.push({label:n.displayName,expandedIcon:"fa fa-folder-open text-warning",collapsedIcon:"fa fa-folder text-warning",selected:!0,children:[],data:n,memberCount:n.memberCount,roleCount:n.roleCount});this.totalUnitCount+=1}deleteUnit(n){let t=this._treeDataHelperService.findNode(this.treeData,{data:{id:n}});if(!t)return;t.data.parentId||(0,O.Z)(this.treeData,{data:{id:n}});let i=this._treeDataHelperService.findNode(this.treeData,{data:{id:t.data.parentId}});i&&(0,O.Z)(i.children,{data:{id:n}})}unitUpdated(n){let t=this._treeDataHelperService.findNode(this.treeData,{data:{id:n.id}});t&&(t.data.displayName=n.displayName,t.label=n.displayName,t.memberCount=n.memberCount,t.roleCount=n.roleCount)}membersAdded(n){this.incrementMemberCount(n.ouId,n.userIds.length)}memberRemoved(n){this.incrementMemberCount(n.ouId,-1)}incrementMemberCount(n,t){let i=this._treeDataHelperService.findNode(this.treeData,{data:{id:n}});i.data.memberCount+=t,i.memberCount=i.data.memberCount}rolesAdded(n){this.incrementRoleCount(n.ouId,n.roleIds.length)}roleRemoved(n){this.incrementRoleCount(n.ouId,-1)}incrementRoleCount(n,t){let i=this._treeDataHelperService.findNode(this.treeData,{data:{id:n}});i.data.roleCount+=t,i.roleCount=i.data.roleCount}getTreeDataFromServer(){this._organizationUnitService.getOrganizationUnits().subscribe(t=>{this.totalUnitCount=t.items.length,this.treeData=this._arrayToTreeConverterService.createTree(t.items,"parentId","id",null,"children",[{target:"label",targetFunction:i=>i.displayName},{target:"expandedIcon",value:"fa fa-folder-open text-warning"},{target:"collapsedIcon",value:"fa fa-folder text-warning"},{target:"selectable",value:!0},{target:"memberCount",targetFunction:i=>i.memberCount},{target:"roleCount",targetFunction:i=>i.roleCount}])})}isEntityHistoryEnabled(){let n=abp.custom;return n.EntityHistory&&n.EntityHistory.isEnabled&&1===(0,H.Z)(n.EntityHistory.enabledEntities,t=>t===this._entityTypeFullName).length}getContextMenuItems(){const n=this.isGranted("Pages.Administration.OrganizationUnits.ManageOrganizationTree");let t=[{label:this.l("Edit"),disabled:!n,command:i=>{this.createOrEditOrganizationUnitModal.show({id:this.selectedOu.data.id,displayName:this.selectedOu.data.displayName})}},{label:this.l("AddSubUnit"),disabled:!n,command:()=>{this.addUnit(this.selectedOu.data.id)}},{label:this.l("Delete"),disabled:!n,command:()=>{this.message.confirm(this.l("OrganizationUnitDeleteWarningMessage",this.selectedOu.data.displayName),this.l("AreYouSure"),i=>{i&&this._organizationUnitService.deleteOrganizationUnit(this.selectedOu.data.id).subscribe(()=>{this.deleteUnit(this.selectedOu.data.id),this.notify.success(this.l("SuccessfullyDeleted")),this.selectedOu=null,this.reload(),this.ouSelected.emit(null)})})}}];return this.isEntityHistoryEnabled()&&t.push({label:this.l("History"),disabled:!1,command:i=>{this.entityTypeHistoryModal.show({entityId:this.selectedOu.data.id.toString(),entityTypeFullName:this._entityTypeFullName,entityTypeDescription:this.selectedOu.data.displayName})}}),t}}return o=r,(0,a.Z)(r,"\u0275fac",function(n){return new(n||o)(e.Y36(e.zs3),e.Y36(c.OAl),e.Y36(J.V),e.Y36(P.j))}),(0,a.Z)(r,"\u0275cmp",e.Xpm({type:o,selectors:[["organization-tree"]],viewQuery:function(n,t){if(1&n&&(e.Gf($,7),e.Gf(X,7)),2&n){let i;e.iGM(i=e.CRH())&&(t.createOrEditOrganizationUnitModal=i.first),e.iGM(i=e.CRH())&&(t.entityTypeHistoryModal=i.first)}},outputs:{ouSelected:"ouSelected"},features:[e.qOj],decls:19,vars:13,consts:[[1,"card","card-custom","gutter-b"],[1,"card-header","align-items-center","border-0"],[1,"card-title","align-items-start","flex-column"],[1,"fw-bolder","text-dark"],[1,"card-toolbar"],["class","btn btn-primary",3,"click",4,"ngIf"],[1,"card-body"],["selectionMode","single",3,"value","selection","contextMenu","draggableNodes","droppableNodes","selectionChange","onNodeSelect","onNodeDrop"],["pTemplate","default"],["appendTo","body","baseZIndex","99999",3,"model"],["ouContextMenu",""],["class","text-muted",4,"ngIf"],[3,"unitCreated","unitUpdated"],["createOrEditOrganizationUnitModal",""],["entityTypeHistoryModal",""],[1,"btn","btn-primary",3,"click"],[1,"fa","fa-plus","btn-md-icon"],[1,"d-none","d-md-inline-block"],[2,"font-size","0.82em","opacity","0.5"],[1,"text-muted"]],template:function(n,t){if(1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h3",2)(3,"span",3),e._uU(4),e.ALo(5,"localize"),e.qZA()(),e.TgZ(6,"div",4),e.YNc(7,V,5,3,"button",5),e.ALo(8,"permission"),e.qZA()(),e.TgZ(9,"div",6)(10,"p-tree",7),e.NdJ("selectionChange",function(s){return t.selectedOu=s})("onNodeSelect",function(s){return t.nodeSelect(s)})("onNodeDrop",function(s){return t.nodeDrop(s)}),e.YNc(11,ee,7,9,"ng-template",8),e.qZA(),e._UZ(12,"p-contextMenu",9,10),e.YNc(14,te,3,3,"div",11),e.qZA()(),e.TgZ(15,"createOrEditOrganizationUnitModal",12,13),e.NdJ("unitCreated",function(s){return t.unitCreated(s)})("unitUpdated",function(s){return t.unitUpdated(s)}),e.qZA(),e._UZ(17,"entityTypeHistoryModal",null,14)),2&n){const i=e.MAs(13);e.xp6(4),e.hij(" ",e.lcZ(5,9,"OrganizationTree")," "),e.xp6(3),e.Q6J("ngIf",e.lcZ(8,11,"Pages.Administration.OrganizationUnits.ManageOrganizationTree")),e.xp6(3),e.Q6J("value",t.treeData)("selection",t.selectedOu)("contextMenu",i)("draggableNodes",t.canManageOrganizationUnits)("droppableNodes",t.canManageOrganizationUnits),e.xp6(2),e.Q6J("model",t.ouContextMenuItems),e.xp6(2),e.Q6J("ngIf",!t.totalUnitCount)}},dependencies:[u.O5,D.A,T.jx,Q.mp,q.xV,W,_.F,v.a],encapsulation:2})),r})();var C=d(94901),m=d(56916),z=d(51712),R=d(74550),N=d(32925);const ie=["modal"],oe=["dataTable"],ae=["paginator"];function re(o,r){1&o&&(e.TgZ(0,"tr")(1,"th",27),e._UZ(2,"p-tableHeaderCheckbox"),e.qZA(),e.TgZ(3,"th"),e._uU(4),e.ALo(5,"localize"),e.qZA()()),2&o&&(e.xp6(4),e.hij(" ",e.lcZ(5,1,"Name")," "))}function le(o,r){if(1&o&&(e.TgZ(0,"tr",28)(1,"td",27)(2,"p-tableCheckbox",29),e.NdJ("click",function(n){return n.stopPropagation()}),e.qZA()(),e.TgZ(3,"td")(4,"span",30),e._uU(5),e.ALo(6,"localize"),e.qZA(),e._uU(7),e.qZA()()),2&o){const l=r.$implicit;e.Q6J("pSelectableRow",l),e.xp6(2),e.Q6J("value",l),e.xp6(3),e.Oqu(e.lcZ(6,4,"Name")),e.xp6(2),e.hij(" ",l.name," ")}}function se(o,r){1&o&&(e.TgZ(0,"div",31),e._uU(1),e.ALo(2,"localize"),e.qZA()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"NoData")," "))}const de=function(o){return{backdrop:"static",keyboard:o}},pe=function(){return{"min-width":"25rem"}};let me=(()=>{var o;class r extends h.c{constructor(n,t){super(n),(0,a.Z)(this,"_organizationUnitService",void 0),(0,a.Z)(this,"membersAdded",new e.vpe),(0,a.Z)(this,"modal",void 0),(0,a.Z)(this,"dataTable",void 0),(0,a.Z)(this,"paginator",void 0),(0,a.Z)(this,"organizationUnitId",void 0),(0,a.Z)(this,"isShown",!1),(0,a.Z)(this,"filterText",""),(0,a.Z)(this,"tenantId",void 0),(0,a.Z)(this,"saving",!1),(0,a.Z)(this,"selectedMembers",void 0),this._organizationUnitService=t}show(){this.modal.show()}refreshTable(){this.paginator.changePage(this.paginator.getPage())}close(){this.modal.hide()}shown(){this.isShown=!0,this.getRecordsIfNeeds(null)}getRecordsIfNeeds(n){this.isShown&&this.getRecords(n)}getRecords(n){if(this.primengTableHelper.shouldResetPaging(n)&&(this.paginator.changePage(0),this.primengTableHelper.records&&this.primengTableHelper.records.length>0))return;this.primengTableHelper.showLoadingIndicator();const t=new c.ht;t.organizationUnitId=this.organizationUnitId,t.filter=this.filterText,t.skipCount=this.primengTableHelper.getSkipCount(this.paginator,n),t.maxResultCount=this.primengTableHelper.getMaxResultCount(this.paginator,n),this._organizationUnitService.findUsers(t).pipe((0,f.x)(()=>this.primengTableHelper.hideLoadingIndicator())).subscribe(i=>{this.primengTableHelper.totalRecordsCount=i.totalCount,this.primengTableHelper.records=i.items,this.primengTableHelper.hideLoadingIndicator()})}addUsersToOrganizationUnit(){const n=new c.o5;n.organizationUnitId=this.organizationUnitId,n.userIds=(0,R.Z)(this.selectedMembers,t=>Number(t.value)),this.saving=!0,this._organizationUnitService.addUsersToOrganizationUnit(n).subscribe(()=>{this.notify.success(this.l("SuccessfullyAdded")),this.membersAdded.emit({userIds:n.userIds,ouId:n.organizationUnitId}),this.saving=!1,this.close(),this.selectedMembers=[]})}}return o=r,(0,a.Z)(r,"\u0275fac",function(n){return new(n||o)(e.Y36(e.zs3),e.Y36(c.OAl))}),(0,a.Z)(r,"\u0275cmp",e.Xpm({type:o,selectors:[["addMemberModal"]],viewQuery:function(n,t){if(1&n&&(e.Gf(ie,7),e.Gf(oe,7),e.Gf(ae,7)),2&n){let i;e.iGM(i=e.CRH())&&(t.modal=i.first),e.iGM(i=e.CRH())&&(t.dataTable=i.first),e.iGM(i=e.CRH())&&(t.paginator=i.first)}},outputs:{membersAdded:"membersAdded"},features:[e.qOj],decls:37,vars:40,consts:[["appBsModal","","tabindex","-1","role","dialog","aria-labelledby","modal","aria-hidden","true",1,"modal","fade",3,"config","onShown"],["modal","bs-modal"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"disabled","click"],[1,"modal-body"],["novalidate","","autocomplete","new-password",3,"ngSubmit"],[1,"input-group","mb-2"],["autoFocus","","name","filterText","type","text",1,"form-control",3,"ngModel","placeholder","ngModelChange"],[1,"input-group-append"],["type","submit",1,"btn","btn-primary"],[1,"flaticon-search-1"],[1,"primeng-datatable-container",3,"busyIf"],["selectionMode","multiple",3,"value","rows","paginator","lazy","tableStyle","selection","onLazyLoad","selectionChange"],["dataTable",""],["pTemplate","header"],["pTemplate","body"],["class","primeng-no-data",4,"ngIf"],[1,"primeng-paging-container"],[3,"rows","totalRecords","rowsPerPageOptions","showCurrentPageReport","currentPageReportTemplate","onPageChange"],["paginator",""],[1,"modal-footer"],["type","button",1,"btn","btn-light-primary","fw-bold",3,"disabled","click"],[1,"btn","btn-primary","fw-bold",3,"buttonBusy","busyText","disabled","click"],[1,"fa","fa-save"],[2,"width","38px"],[3,"pSelectableRow"],[3,"value","click"],[1,"p-column-title"],[1,"primeng-no-data"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0,1),e.NdJ("onShown",function(){return t.shown()}),e.TgZ(2,"div",2)(3,"div",3)(4,"div",4)(5,"h5",5)(6,"span"),e._uU(7),e.ALo(8,"localize"),e.qZA()(),e.TgZ(9,"button",6),e.NdJ("click",function(){return t.close()}),e.qZA()(),e.TgZ(10,"div",7)(11,"form",8),e.NdJ("ngSubmit",function(){return t.refreshTable()}),e.TgZ(12,"div",9)(13,"input",10),e.NdJ("ngModelChange",function(s){return t.filterText=s}),e.ALo(14,"localize"),e.qZA(),e.TgZ(15,"div",11)(16,"button",12),e._UZ(17,"i",13),e.qZA()()(),e.TgZ(18,"div",14)(19,"p-table",15,16),e.NdJ("onLazyLoad",function(s){return t.getRecordsIfNeeds(s)})("selectionChange",function(s){return t.selectedMembers=s}),e.YNc(21,re,6,3,"ng-template",17),e.YNc(22,le,8,6,"ng-template",18),e.qZA(),e.YNc(23,se,3,3,"div",19),e.TgZ(24,"div",20)(25,"p-paginator",21,22),e.NdJ("onPageChange",function(s){return t.getRecordsIfNeeds(s)}),e.ALo(27,"localize"),e.qZA()()()()(),e.TgZ(28,"div",23)(29,"button",24),e.NdJ("click",function(){return t.close()}),e._uU(30),e.ALo(31,"localize"),e.qZA(),e.TgZ(32,"button",25),e.NdJ("click",function(){return t.addUsersToOrganizationUnit()}),e._UZ(33,"i",26),e.TgZ(34,"span"),e._uU(35),e.ALo(36,"localize"),e.qZA()()()()()()),2&n&&(e.Q6J("config",e.VKq(37,de,!t.saving)),e.xp6(7),e.Oqu(e.lcZ(8,26,"SelectUsers")),e.xp6(2),e.Q6J("disabled",t.saving),e.uIk("aria-label",t.l("Close")),e.xp6(4),e.s9C("placeholder",e.lcZ(14,28,"SearchWithThreeDot")),e.Q6J("ngModel",t.filterText),e.xp6(4),e.uIk("aria-label",t.l("Search")),e.xp6(1),e.Q6J("busyIf",t.primengTableHelper.isLoading),e.xp6(1),e.s9C("rows",t.primengTableHelper.defaultRecordsCountPerPage),e.Q6J("value",t.primengTableHelper.records)("paginator",!1)("lazy",!0)("tableStyle",e.DdM(39,pe))("selection",t.selectedMembers),e.xp6(4),e.Q6J("ngIf",0==t.primengTableHelper.totalRecordsCount),e.xp6(2),e.Q6J("rows",t.primengTableHelper.defaultRecordsCountPerPage)("totalRecords",t.primengTableHelper.totalRecordsCount)("rowsPerPageOptions",t.primengTableHelper.predefinedRecordsCountPerPage)("showCurrentPageReport",!0)("currentPageReportTemplate",e.xi3(27,30,"TotalRecordsCount",t.primengTableHelper.totalRecordsCount)),e.xp6(4),e.Q6J("disabled",t.saving),e.xp6(1),e.hij(" ",e.lcZ(31,33,"Cancel")," "),e.xp6(2),e.Q6J("buttonBusy",t.saving)("busyText",t.l("SavingWithThreeDot"))("disabled",!(null!=t.selectedMembers&&t.selectedMembers.length)),e.xp6(3),e.Oqu(e.lcZ(36,35,"Save")))},dependencies:[u.O5,p._Y,p.Fj,p.JJ,p.JL,p.On,p.F,Z.L,N.h,C.U,m.iA,T.jx,m.Ei,m.UA,m.Mo,z.D,U.Z,_.F],encapsulation:2})),r})();var x=d(88922);const ce=["addMemberModal"],ge=["dataTable"],ue=["paginator"];function he(o,r){if(1&o){const l=e.EpF();e.TgZ(0,"button",17),e.NdJ("click",function(){e.CHM(l);const t=e.oxw();return e.KtG(t.openAddMemberModal())}),e._UZ(1,"i",18),e._uU(2),e.ALo(3,"localize"),e.qZA()}2&o&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"AddMember")," "))}function _e(o,r){1&o&&(e.TgZ(0,"tr")(1,"th",19),e.ALo(2,"permission"),e._uU(3),e.ALo(4,"localize"),e.qZA(),e.TgZ(5,"th",20),e._uU(6),e.ALo(7,"localize"),e._UZ(8,"p-sortIcon",21),e.qZA(),e.TgZ(9,"th",22),e._uU(10),e.ALo(11,"localize"),e._UZ(12,"p-sortIcon",23),e.qZA()()),2&o&&(e.xp6(1),e.Q6J("hidden",!e.lcZ(2,4,"Pages.Administration.OrganizationUnits.ManageMembers")),e.xp6(2),e.hij(" ",e.lcZ(4,6,"Delete")," "),e.xp6(3),e.hij(" ",e.lcZ(7,8,"UserName")," "),e.xp6(4),e.hij(" ",e.lcZ(11,10,"AddedTime")," "))}function be(o,r){if(1&o){const l=e.EpF();e.TgZ(0,"tr")(1,"td",24),e.ALo(2,"permission"),e.TgZ(3,"button",25),e.NdJ("click",function(){const i=e.CHM(l).$implicit,s=e.oxw();return e.KtG(s.removeMember(i))}),e.ALo(4,"localize"),e._UZ(5,"i",26),e.qZA()(),e.TgZ(6,"td")(7,"span",27),e._uU(8),e.ALo(9,"localize"),e.qZA(),e._uU(10),e.qZA(),e.TgZ(11,"td")(12,"span",27),e._uU(13),e.ALo(14,"localize"),e.qZA(),e._uU(15),e.ALo(16,"luxonFormat"),e.qZA()()}if(2&o){const l=r.$implicit,n=e.oxw();e.xp6(1),e.Q6J("hidden",!e.lcZ(2,7,"Pages.Administration.OrganizationUnits.ManageMembers")),e.xp6(2),e.s9C("title",e.lcZ(4,9,"Delete")),e.xp6(2),e.uIk("aria-label",n.l("Delete")),e.xp6(3),e.Oqu(e.lcZ(9,11,"UserName")),e.xp6(2),e.hij(" ",l.userName," "),e.xp6(3),e.Oqu(e.lcZ(14,13,"AddedTime")),e.xp6(2),e.hij(" ",e.xi3(16,15,l.addedTime,"F")," ")}}function fe(o,r){1&o&&(e.TgZ(0,"div",28),e._uU(1),e.ALo(2,"localize"),e.qZA()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"NoData")," "))}function Te(o,r){1&o&&(e.TgZ(0,"div",29),e._uU(1),e.ALo(2,"localize"),e.qZA()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"SelectAnOrganizationUnitToSeeMembers"),"\n"))}const Ce=function(){return{"min-width":"25rem"}};let ze=(()=>{var o;class r extends h.c{constructor(n,t){super(n),(0,a.Z)(this,"_organizationUnitService",void 0),(0,a.Z)(this,"memberRemoved",new e.vpe),(0,a.Z)(this,"membersAdded",new e.vpe),(0,a.Z)(this,"addMemberModal",void 0),(0,a.Z)(this,"dataTable",void 0),(0,a.Z)(this,"paginator",void 0),(0,a.Z)(this,"_organizationUnit",null),this._organizationUnitService=t}get organizationUnit(){return this._organizationUnit}set organizationUnit(n){n?this._organizationUnit!==n&&(this._organizationUnit=n,this.addMemberModal.organizationUnitId=n.id,n&&this.refreshMembers()):this._organizationUnit=null}ngOnInit(){}getOrganizationUnitUsers(n){this._organizationUnit&&(this.primengTableHelper.shouldResetPaging(n)&&(this.paginator.changePage(0),this.primengTableHelper.records&&this.primengTableHelper.records.length>0)||(this.primengTableHelper.showLoadingIndicator(),this._organizationUnitService.getOrganizationUnitUsers(this._organizationUnit.id,this.primengTableHelper.getSorting(this.dataTable),this.primengTableHelper.getMaxResultCount(this.paginator,n),this.primengTableHelper.getSkipCount(this.paginator,n)).pipe((0,f.x)(()=>this.primengTableHelper.hideLoadingIndicator())).subscribe(t=>{this.primengTableHelper.totalRecordsCount=t.totalCount,this.primengTableHelper.records=t.items,this.primengTableHelper.hideLoadingIndicator()})))}reloadPage(){this.getOrganizationUnitUsers(null),this.paginator.changePage(this.paginator.getPage())}refreshMembers(){this.reloadPage()}openAddMemberModal(){this.addMemberModal.show()}removeMember(n){this.message.confirm(this.l("RemoveUserFromOuWarningMessage",n.userName,this.organizationUnit.displayName),this.l("AreYouSure"),t=>{t&&this._organizationUnitService.removeUserFromOrganizationUnit(n.id,this.organizationUnit.id).subscribe(()=>{this.notify.success(this.l("SuccessfullyRemoved")),this.memberRemoved.emit({userId:n.id,ouId:this.organizationUnit.id}),this.refreshMembers()})})}addMembers(n){this.membersAdded.emit({userIds:n.userIds,ouId:n.ouId}),this.refreshMembers()}}return o=r,(0,a.Z)(r,"\u0275fac",function(n){return new(n||o)(e.Y36(e.zs3),e.Y36(c.OAl))}),(0,a.Z)(r,"\u0275cmp",e.Xpm({type:o,selectors:[["organization-unit-members"]],viewQuery:function(n,t){if(1&n&&(e.Gf(ce,7),e.Gf(ge,7),e.Gf(ue,7)),2&n){let i;e.iGM(i=e.CRH())&&(t.addMemberModal=i.first),e.iGM(i=e.CRH())&&(t.dataTable=i.first),e.iGM(i=e.CRH())&&(t.paginator=i.first)}},outputs:{memberRemoved:"memberRemoved",membersAdded:"membersAdded"},features:[e.qOj],decls:19,vars:21,consts:[[1,"row"],[1,"col-12","p-3"],["class","btn btn-primary float-end mb-3",3,"click",4,"ngIf"],[1,"col-12"],["id","OuMembersTable"],[1,"primeng-datatable-container",3,"busyIf","hidden"],["sortMode","multiple",3,"value","rows","paginator","lazy","tableStyle","onLazyLoad"],["dataTable",""],["pTemplate","header"],["pTemplate","body"],["class","primeng-no-data",4,"ngIf"],[1,"primeng-paging-container"],[3,"rows","totalRecords","rowsPerPageOptions","showCurrentPageReport","currentPageReportTemplate","onPageChange"],["paginator",""],["class","text-muted",4,"ngIf"],[3,"membersAdded"],["addMemberModal",""],[1,"btn","btn-primary","float-end","mb-3",3,"click"],[1,"fa","fa-plus"],[2,"width","15%",3,"hidden"],["pSortableColumn","userName"],["field","userName"],["pSortableColumn","addedTime"],["field","addedTime"],[3,"hidden"],[1,"btn","btn-icon","btn-bg-light","btn-active-color-danger","btn-sm",3,"title","click"],[1,"fa","fa-times"],[1,"p-column-title"],[1,"primeng-no-data"],[1,"text-muted"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"div",1),e.YNc(2,he,4,3,"button",2),e.ALo(3,"permission"),e.qZA(),e.TgZ(4,"div",3)(5,"div",4)(6,"div",5)(7,"p-table",6,7),e.NdJ("onLazyLoad",function(s){return t.getOrganizationUnitUsers(s)}),e.YNc(9,_e,13,12,"ng-template",8),e.YNc(10,be,17,18,"ng-template",9),e.qZA(),e.YNc(11,fe,3,3,"div",10),e.TgZ(12,"div",11)(13,"p-paginator",12,13),e.NdJ("onPageChange",function(s){return t.getOrganizationUnitUsers(s)}),e.ALo(15,"localize"),e.qZA()()()()()(),e.YNc(16,Te,3,3,"div",14),e.TgZ(17,"addMemberModal",15,16),e.NdJ("membersAdded",function(s){return t.addMembers(s)}),e.qZA()),2&n&&(e.xp6(2),e.Q6J("ngIf",e.lcZ(3,15,"Pages.Administration.OrganizationUnits.ManageMembers")&&t.organizationUnit),e.xp6(4),e.Q6J("busyIf",t.primengTableHelper.isLoading)("hidden",!t.organizationUnit),e.xp6(1),e.s9C("rows",t.primengTableHelper.defaultRecordsCountPerPage),e.Q6J("value",t.primengTableHelper.records)("paginator",!1)("lazy",!0)("tableStyle",e.DdM(20,Ce)),e.xp6(4),e.Q6J("ngIf",0==t.primengTableHelper.totalRecordsCount),e.xp6(2),e.Q6J("rows",t.primengTableHelper.defaultRecordsCountPerPage)("totalRecords",t.primengTableHelper.totalRecordsCount)("rowsPerPageOptions",t.primengTableHelper.predefinedRecordsCountPerPage)("showCurrentPageReport",!0)("currentPageReportTemplate",e.xi3(15,17,"TotalRecordsCount",t.primengTableHelper.totalRecordsCount)),e.xp6(3),e.Q6J("ngIf",!t.organizationUnit))},dependencies:[u.O5,C.U,m.iA,T.jx,m.lQ,m.fz,z.D,me,x.n,_.F,v.a],encapsulation:2})),r})();const Ze=["modal"],Ue=["dataTable"],ve=["paginator"];function Me(o,r){1&o&&(e.TgZ(0,"tr")(1,"th",27),e._UZ(2,"p-tableHeaderCheckbox"),e.qZA(),e.TgZ(3,"th"),e._uU(4),e.ALo(5,"localize"),e.qZA()()),2&o&&(e.xp6(4),e.hij(" ",e.lcZ(5,1,"Name")," "))}function Ae(o,r){if(1&o&&(e.TgZ(0,"tr",28)(1,"td",27)(2,"p-tableCheckbox",29),e.NdJ("click",function(n){return n.stopPropagation()}),e.qZA()(),e.TgZ(3,"td")(4,"span",30),e._uU(5),e.ALo(6,"localize"),e.qZA(),e._uU(7),e.qZA()()),2&o){const l=r.$implicit;e.Q6J("pSelectableRow",l),e.xp6(2),e.Q6J("value",l),e.xp6(3),e.Oqu(e.lcZ(6,4,"Name")),e.xp6(2),e.hij(" ",l.name," ")}}function ye(o,r){1&o&&(e.TgZ(0,"div",31),e._uU(1),e.ALo(2,"localize"),e.qZA()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"NoData")," "))}const Oe=function(o){return{backdrop:"static",keyboard:o}},Re=function(){return{"min-width":"25rem"}};let Ne=(()=>{var o;class r extends h.c{constructor(n,t){super(n),(0,a.Z)(this,"_organizationUnitService",void 0),(0,a.Z)(this,"rolesAdded",new e.vpe),(0,a.Z)(this,"modal",void 0),(0,a.Z)(this,"dataTable",void 0),(0,a.Z)(this,"paginator",void 0),(0,a.Z)(this,"organizationUnitId",void 0),(0,a.Z)(this,"isShown",!1),(0,a.Z)(this,"filterText",""),(0,a.Z)(this,"tenantId",void 0),(0,a.Z)(this,"saving",!1),(0,a.Z)(this,"selectedRoles",void 0),this._organizationUnitService=t}show(){this.modal.show()}refreshTable(){this.paginator.changePage(this.paginator.getPage())}close(){this.modal.hide()}shown(){this.isShown=!0,this.getRecordsIfNeeds(null)}getRecordsIfNeeds(n){this.isShown&&this.getRecords(n)}getRecords(n){if(this.primengTableHelper.shouldResetPaging(n)&&(this.paginator.changePage(0),this.primengTableHelper.records&&this.primengTableHelper.records.length>0))return;this.primengTableHelper.showLoadingIndicator();const t=new c.eQS;t.organizationUnitId=this.organizationUnitId,t.filter=this.filterText,t.skipCount=this.primengTableHelper.getSkipCount(this.paginator,n),t.maxResultCount=this.primengTableHelper.getMaxResultCount(this.paginator,n),this._organizationUnitService.findRoles(t).pipe((0,f.x)(()=>this.primengTableHelper.hideLoadingIndicator())).subscribe(i=>{this.primengTableHelper.totalRecordsCount=i.totalCount,this.primengTableHelper.records=i.items,this.primengTableHelper.hideLoadingIndicator()})}addRolesToOrganizationUnit(){const n=new c.r96;n.organizationUnitId=this.organizationUnitId,n.roleIds=(0,R.Z)(this.selectedRoles,t=>Number(t.value)),this.saving=!0,this._organizationUnitService.addRolesToOrganizationUnit(n).subscribe(()=>{this.notify.success(this.l("SuccessfullyAdded")),this.rolesAdded.emit({roleIds:n.roleIds,ouId:n.organizationUnitId}),this.saving=!1,this.close(),this.selectedRoles=[]})}}return o=r,(0,a.Z)(r,"\u0275fac",function(n){return new(n||o)(e.Y36(e.zs3),e.Y36(c.OAl))}),(0,a.Z)(r,"\u0275cmp",e.Xpm({type:o,selectors:[["addRoleModal"]],viewQuery:function(n,t){if(1&n&&(e.Gf(Ze,7),e.Gf(Ue,7),e.Gf(ve,7)),2&n){let i;e.iGM(i=e.CRH())&&(t.modal=i.first),e.iGM(i=e.CRH())&&(t.dataTable=i.first),e.iGM(i=e.CRH())&&(t.paginator=i.first)}},outputs:{rolesAdded:"rolesAdded"},features:[e.qOj],decls:37,vars:40,consts:[["appBsModal","","tabindex","-1","role","dialog","aria-labelledby","modal","aria-hidden","true",1,"modal","fade",3,"config","onShown"],["modal","bs-modal"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"disabled","click"],[1,"modal-body"],["novalidate","","autocomplete","new-password",3,"ngSubmit"],[1,"input-group","mb-2"],["autoFocus","","name","filterText","type","text",1,"form-control",3,"ngModel","placeholder","ngModelChange"],[1,"input-group-append"],["type","submit",1,"btn","btn-primary"],[1,"flaticon-search-1"],[1,"primeng-datatable-container",3,"busyIf"],["selectionMode","multiple",3,"value","rows","paginator","lazy","tableStyle","selection","onLazyLoad","selectionChange"],["dataTable",""],["pTemplate","header"],["pTemplate","body"],["class","primeng-no-data",4,"ngIf"],[1,"primeng-paging-container"],[3,"rows","totalRecords","rowsPerPageOptions","showCurrentPageReport","currentPageReportTemplate","onPageChange"],["paginator",""],[1,"modal-footer"],["type","button",1,"btn","btn-light-primary","fw-bold",3,"disabled","click"],[1,"btn","btn-primary","fw-bold",3,"buttonBusy","busyText","disabled","click"],[1,"fa","fa-save"],[2,"width","38px"],[3,"pSelectableRow"],[3,"value","click"],[1,"p-column-title"],[1,"primeng-no-data"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0,1),e.NdJ("onShown",function(){return t.shown()}),e.TgZ(2,"div",2)(3,"div",3)(4,"div",4)(5,"h5",5)(6,"span"),e._uU(7),e.ALo(8,"localize"),e.qZA()(),e.TgZ(9,"button",6),e.NdJ("click",function(){return t.close()}),e.qZA()(),e.TgZ(10,"div",7)(11,"form",8),e.NdJ("ngSubmit",function(){return t.refreshTable()}),e.TgZ(12,"div",9)(13,"input",10),e.NdJ("ngModelChange",function(s){return t.filterText=s}),e.ALo(14,"localize"),e.qZA(),e.TgZ(15,"div",11)(16,"button",12),e._UZ(17,"i",13),e.qZA()()(),e.TgZ(18,"div",14)(19,"p-table",15,16),e.NdJ("onLazyLoad",function(s){return t.getRecordsIfNeeds(s)})("selectionChange",function(s){return t.selectedRoles=s}),e.YNc(21,Me,6,3,"ng-template",17),e.YNc(22,Ae,8,6,"ng-template",18),e.qZA(),e.YNc(23,ye,3,3,"div",19),e.TgZ(24,"div",20)(25,"p-paginator",21,22),e.NdJ("onPageChange",function(s){return t.getRecordsIfNeeds(s)}),e.ALo(27,"localize"),e.qZA()()()()(),e.TgZ(28,"div",23)(29,"button",24),e.NdJ("click",function(){return t.close()}),e._uU(30),e.ALo(31,"localize"),e.qZA(),e.TgZ(32,"button",25),e.NdJ("click",function(){return t.addRolesToOrganizationUnit()}),e._UZ(33,"i",26),e.TgZ(34,"span"),e._uU(35),e.ALo(36,"localize"),e.qZA()()()()()()),2&n&&(e.Q6J("config",e.VKq(37,Oe,!t.saving)),e.xp6(7),e.Oqu(e.lcZ(8,26,"SelectRoles")),e.xp6(2),e.Q6J("disabled",t.saving),e.uIk("aria-label",t.l("Close")),e.xp6(4),e.s9C("placeholder",e.lcZ(14,28,"SearchWithThreeDot")),e.Q6J("ngModel",t.filterText),e.xp6(4),e.uIk("aria-label",t.l("Search")),e.xp6(1),e.Q6J("busyIf",t.primengTableHelper.isLoading),e.xp6(1),e.s9C("rows",t.primengTableHelper.defaultRecordsCountPerPage),e.Q6J("value",t.primengTableHelper.records)("paginator",!1)("lazy",!0)("tableStyle",e.DdM(39,Re))("selection",t.selectedRoles),e.xp6(4),e.Q6J("ngIf",0==t.primengTableHelper.totalRecordsCount),e.xp6(2),e.Q6J("rows",t.primengTableHelper.defaultRecordsCountPerPage)("totalRecords",t.primengTableHelper.totalRecordsCount)("rowsPerPageOptions",t.primengTableHelper.predefinedRecordsCountPerPage)("showCurrentPageReport",!0)("currentPageReportTemplate",e.xi3(27,30,"TotalRecordsCount",t.primengTableHelper.totalRecordsCount)),e.xp6(4),e.Q6J("disabled",t.saving),e.xp6(1),e.hij(" ",e.lcZ(31,33,"Cancel")," "),e.xp6(2),e.Q6J("buttonBusy",t.saving)("busyText",t.l("SavingWithThreeDot"))("disabled",!(null!=t.selectedRoles&&t.selectedRoles.length)),e.xp6(3),e.Oqu(e.lcZ(36,35,"Save")))},dependencies:[u.O5,p._Y,p.Fj,p.JJ,p.JL,p.On,p.F,Z.L,N.h,C.U,m.iA,T.jx,m.Ei,m.UA,m.Mo,z.D,U.Z,_.F],encapsulation:2})),r})();const xe=["addRoleModal"],Ie=["dataTable"],Se=["paginator"];function He(o,r){if(1&o){const l=e.EpF();e.TgZ(0,"button",17),e.NdJ("click",function(){e.CHM(l);const t=e.oxw();return e.KtG(t.openAddRoleModal())}),e._UZ(1,"i",18),e._uU(2),e.ALo(3,"localize"),e.qZA()}2&o&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"AddRole")," "))}function we(o,r){1&o&&(e.TgZ(0,"tr")(1,"th",19),e.ALo(2,"permission"),e._uU(3),e.ALo(4,"localize"),e.qZA(),e.TgZ(5,"th",20),e._uU(6),e.ALo(7,"localize"),e._UZ(8,"p-sortIcon",21),e.qZA(),e.TgZ(9,"th",22),e._uU(10),e.ALo(11,"localize"),e._UZ(12,"p-sortIcon",23),e.qZA()()),2&o&&(e.xp6(1),e.Q6J("hidden",!e.lcZ(2,4,"Pages.Administration.OrganizationUnits.ManageRoles")),e.xp6(2),e.hij(" ",e.lcZ(4,6,"Delete")," "),e.xp6(3),e.hij(" ",e.lcZ(7,8,"Role")," "),e.xp6(4),e.hij(" ",e.lcZ(11,10,"AddedTime")," "))}function Le(o,r){if(1&o){const l=e.EpF();e.TgZ(0,"tr")(1,"td",24),e.ALo(2,"permission"),e.TgZ(3,"button",25),e.NdJ("click",function(){const i=e.CHM(l).$implicit,s=e.oxw();return e.KtG(s.removeRole(i))}),e.ALo(4,"localize"),e._UZ(5,"i",26),e.qZA()(),e.TgZ(6,"td")(7,"span",27),e._uU(8),e.ALo(9,"localize"),e.qZA(),e._uU(10),e.qZA(),e.TgZ(11,"td")(12,"span",27),e._uU(13),e.ALo(14,"localize"),e.qZA(),e._uU(15),e.ALo(16,"luxonFormat"),e.qZA()()}if(2&o){const l=r.$implicit,n=e.oxw();e.xp6(1),e.Q6J("hidden",!e.lcZ(2,7,"Pages.Administration.OrganizationUnits.ManageRoles")),e.xp6(2),e.s9C("title",e.lcZ(4,9,"Delete")),e.xp6(2),e.uIk("aria-label",n.l("Delete")),e.xp6(3),e.Oqu(e.lcZ(9,11,"Role")),e.xp6(2),e.hij(" ",l.displayName," "),e.xp6(3),e.Oqu(e.lcZ(14,13,"AddedTime")),e.xp6(2),e.hij(" ",e.xi3(16,15,l.addedTime,"F")," ")}}function Je(o,r){1&o&&(e.TgZ(0,"div",28),e._uU(1),e.ALo(2,"localize"),e.qZA()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"NoData")," "))}function Pe(o,r){1&o&&(e.TgZ(0,"div",29),e._uU(1),e.ALo(2,"localize"),e.qZA()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"SelectAnOrganizationUnitToSeeRoles"),"\n"))}const De=function(){return{"min-width":"25rem"}};let Qe=(()=>{var o;class r extends h.c{constructor(n,t,i){super(n),(0,a.Z)(this,"_changeDetector",void 0),(0,a.Z)(this,"_organizationUnitService",void 0),(0,a.Z)(this,"roleRemoved",new e.vpe),(0,a.Z)(this,"rolesAdded",new e.vpe),(0,a.Z)(this,"addRoleModal",void 0),(0,a.Z)(this,"dataTable",void 0),(0,a.Z)(this,"paginator",void 0),(0,a.Z)(this,"_organizationUnit",null),this._changeDetector=t,this._organizationUnitService=i}get organizationUnit(){return this._organizationUnit}set organizationUnit(n){n?this._organizationUnit!==n&&(this._organizationUnit=n,this.addRoleModal.organizationUnitId=n.id,n&&this.refreshRoles()):this._organizationUnit=null}ngOnInit(){}getOrganizationUnitRoles(n){this._organizationUnit&&(this.primengTableHelper.shouldResetPaging(n)&&(this.paginator.changePage(0),this.primengTableHelper.records&&this.primengTableHelper.records.length>0)||(this.primengTableHelper.showLoadingIndicator(),this._organizationUnitService.getOrganizationUnitRoles(this._organizationUnit.id,this.primengTableHelper.getSorting(this.dataTable),this.primengTableHelper.getMaxResultCount(this.paginator,n),this.primengTableHelper.getSkipCount(this.paginator,n)).pipe((0,f.x)(()=>this.primengTableHelper.hideLoadingIndicator())).subscribe(t=>{this.primengTableHelper.totalRecordsCount=t.totalCount,this.primengTableHelper.records=t.items,this.primengTableHelper.hideLoadingIndicator()})))}reloadPage(){this.getOrganizationUnitRoles(null),this.paginator.changePage(this.paginator.getPage())}refreshRoles(){this.reloadPage()}openAddRoleModal(){this.addRoleModal.show()}removeRole(n){this.message.confirm(this.l("RemoveRoleFromOuWarningMessage",n.displayName,this.organizationUnit.displayName),this.l("AreYouSure"),t=>{t&&this._organizationUnitService.removeRoleFromOrganizationUnit(n.id,this.organizationUnit.id).subscribe(()=>{this.notify.success(this.l("SuccessfullyRemoved")),this.roleRemoved.emit({roleId:n.id,ouId:this.organizationUnit.id}),this.refreshRoles()})})}addRoles(n){this.rolesAdded.emit({roleIds:n.roleIds,ouId:n.ouId}),this.refreshRoles()}}return o=r,(0,a.Z)(r,"\u0275fac",function(n){return new(n||o)(e.Y36(e.zs3),e.Y36(e.sBO),e.Y36(c.OAl))}),(0,a.Z)(r,"\u0275cmp",e.Xpm({type:o,selectors:[["organization-unit-roles"]],viewQuery:function(n,t){if(1&n&&(e.Gf(xe,7),e.Gf(Ie,7),e.Gf(Se,7)),2&n){let i;e.iGM(i=e.CRH())&&(t.addRoleModal=i.first),e.iGM(i=e.CRH())&&(t.dataTable=i.first),e.iGM(i=e.CRH())&&(t.paginator=i.first)}},outputs:{roleRemoved:"roleRemoved",rolesAdded:"rolesAdded"},features:[e.qOj],decls:19,vars:21,consts:[[1,"row"],[1,"col-12","p-3"],["class","btn btn-primary float-end mb-3",3,"click",4,"ngIf"],[1,"col-12"],["id","OuRolesTable"],[1,"primeng-datatable-container",3,"busyIf","hidden"],["sortMode","multiple",3,"value","rows","paginator","lazy","tableStyle","onLazyLoad"],["dataTable",""],["pTemplate","header"],["pTemplate","body"],["class","primeng-no-data",4,"ngIf"],[1,"primeng-paging-container"],[3,"rows","totalRecords","rowsPerPageOptions","showCurrentPageReport","currentPageReportTemplate","onPageChange"],["paginator",""],["class","text-muted",4,"ngIf"],[3,"rolesAdded"],["addRoleModal",""],[1,"btn","btn-primary","float-end","mb-3",3,"click"],[1,"fa","fa-plus"],[2,"width","15%",3,"hidden"],["pSortableColumn","displayName"],["field","displayName"],["pSortableColumn","addedTime"],["field","addedTime"],[3,"hidden"],[1,"btn","btn-icon","btn-bg-light","btn-active-color-danger","btn-sm",3,"title","click"],[1,"fa","fa-times"],[1,"p-column-title"],[1,"primeng-no-data"],[1,"text-muted"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"div",1),e.YNc(2,He,4,3,"button",2),e.ALo(3,"permission"),e.qZA(),e.TgZ(4,"div",3)(5,"div",4)(6,"div",5)(7,"p-table",6,7),e.NdJ("onLazyLoad",function(s){return t.getOrganizationUnitRoles(s)}),e.YNc(9,we,13,12,"ng-template",8),e.YNc(10,Le,17,18,"ng-template",9),e.qZA(),e.YNc(11,Je,3,3,"div",10),e.TgZ(12,"div",11)(13,"p-paginator",12,13),e.NdJ("onPageChange",function(s){return t.getOrganizationUnitRoles(s)}),e.ALo(15,"localize"),e.qZA()()()()()(),e.YNc(16,Pe,3,3,"div",14),e.TgZ(17,"addRoleModal",15,16),e.NdJ("rolesAdded",function(s){return t.addRoles(s)}),e.qZA()),2&n&&(e.xp6(2),e.Q6J("ngIf",e.lcZ(3,15,"Pages.Administration.OrganizationUnits.ManageRoles")&&t.organizationUnit),e.xp6(4),e.Q6J("busyIf",t.primengTableHelper.isLoading)("hidden",!t.organizationUnit),e.xp6(1),e.s9C("rows",t.primengTableHelper.defaultRecordsCountPerPage),e.Q6J("value",t.primengTableHelper.records)("paginator",!1)("lazy",!0)("tableStyle",e.DdM(20,De)),e.xp6(4),e.Q6J("ngIf",0==t.primengTableHelper.totalRecordsCount),e.xp6(2),e.Q6J("rows",t.primengTableHelper.defaultRecordsCountPerPage)("totalRecords",t.primengTableHelper.totalRecordsCount)("rowsPerPageOptions",t.primengTableHelper.predefinedRecordsCountPerPage)("showCurrentPageReport",!0)("currentPageReportTemplate",e.xi3(15,17,"TotalRecordsCount",t.primengTableHelper.totalRecordsCount)),e.xp6(3),e.Q6J("ngIf",!t.organizationUnit))},dependencies:[u.O5,C.U,m.iA,T.jx,m.lQ,m.fz,z.D,Ne,x.n,_.F,v.a],encapsulation:2})),r})();const qe=["ouMembers"],Ge=["ouRoles"],Ee=["ouTree"];function Fe(o,r){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const l=e.oxw();e.xp6(1),e.Oqu(l.organizationUnit.displayName)}}const je=[{path:"",component:(()=>{var o;class r extends h.c{constructor(n){super(n),(0,a.Z)(this,"ouMembers",void 0),(0,a.Z)(this,"ouRoles",void 0),(0,a.Z)(this,"ouTree",void 0),(0,a.Z)(this,"organizationUnit",null)}ouSelected(n){this.organizationUnit=n,this.ouMembers.organizationUnit=n,this.ouRoles.organizationUnit=n}}return o=r,(0,a.Z)(r,"\u0275fac",function(n){return new(n||o)(e.Y36(e.zs3))}),(0,a.Z)(r,"\u0275cmp",e.Xpm({type:o,selectors:[["ng-component"]],viewQuery:function(n,t){if(1&n&&(e.Gf(qe,7),e.Gf(Ge,7),e.Gf(Ee,7)),2&n){let i;e.iGM(i=e.CRH())&&(t.ouMembers=i.first),e.iGM(i=e.CRH())&&(t.ouRoles=i.first),e.iGM(i=e.CRH())&&(t.ouTree=i.first)}},features:[e.qOj],decls:25,vars:17,consts:[[3,"title","description"],[1,"row"],[1,"col-6"],[3,"ouSelected"],["ouTree",""],[1,"card","card-custom","gutter-b"],[1,"card-header","align-items-center","border-0"],[1,"card-title","align-items-start","flex-column"],[1,"fw-bolder","text-dark"],[4,"ngIf"],[1,"card-body"],[1,"tab-container"],[3,"heading","active"],[3,"membersAdded","memberRemoved"],["ouMembers",""],[3,"heading"],[3,"rolesAdded","roleRemoved"],["ouRoles",""]],template:function(n,t){if(1&n){const i=e.EpF();e.TgZ(0,"div"),e._UZ(1,"sub-header",0),e.ALo(2,"localize"),e.ALo(3,"localize"),e.TgZ(4,"div")(5,"div",1)(6,"div",2)(7,"organization-tree",3,4),e.NdJ("ouSelected",function(g){return t.ouSelected(g)}),e.qZA()(),e.TgZ(9,"div",2)(10,"div",5)(11,"div",6)(12,"h3",7)(13,"span",8),e.YNc(14,Fe,2,1,"span",9),e.qZA()()(),e.TgZ(15,"div",10)(16,"tabset",11)(17,"tab",12),e.ALo(18,"localize"),e.TgZ(19,"organization-unit-members",13,14),e.NdJ("membersAdded",function(g){e.CHM(i);const b=e.MAs(8);return e.KtG(b.membersAdded(g))})("memberRemoved",function(g){e.CHM(i);const b=e.MAs(8);return e.KtG(b.memberRemoved(g))}),e.qZA()(),e.TgZ(21,"tab",15),e.ALo(22,"localize"),e.TgZ(23,"organization-unit-roles",16,17),e.NdJ("rolesAdded",function(g){e.CHM(i);const b=e.MAs(8);return e.KtG(b.rolesAdded(g))})("roleRemoved",function(g){e.CHM(i);const b=e.MAs(8);return e.KtG(b.roleRemoved(g))}),e.qZA()()()()()()()()()}2&n&&(e.Q6J("@routerTransition",void 0),e.xp6(1),e.Q6J("title",e.lcZ(2,9,"OrganizationUnits"))("description",e.lcZ(3,11,"OrganizationUnitsHeaderInfo")),e.xp6(3),e.Tol(t.containerClass),e.xp6(10),e.Q6J("ngIf",t.organizationUnit),e.xp6(3),e.s9C("heading",e.lcZ(18,13,"Members")),e.Q6J("active",!0),e.xp6(4),e.s9C("heading",e.lcZ(22,15,"Roles")))},dependencies:[u.O5,y.wW,y.AH,S.$,ne,ze,Qe,_.F],encapsulation:2,data:{animation:[(0,I.MH)()]}})),r})(),pathMatch:"full"}];let Ye=(()=>{var o;class r{}return o=r,(0,a.Z)(r,"\u0275fac",function(n){return new(n||o)}),(0,a.Z)(r,"\u0275mod",e.oAB({type:o})),(0,a.Z)(r,"\u0275inj",e.cJS({imports:[A.Bz.forChild(je),A.Bz]})),r})();var ke=d(8387),Be=d(40031);let Ke=(()=>{var o;class r{}return o=r,(0,a.Z)(r,"\u0275fac",function(n){return new(n||o)}),(0,a.Z)(r,"\u0275mod",e.oAB({type:o})),(0,a.Z)(r,"\u0275inj",e.cJS({imports:[Be.o,ke.g,Ye]})),r})()}}]);