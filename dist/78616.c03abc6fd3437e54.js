"use strict";(self.webpackChunkabp_zero_template=self.webpackChunkabp_zero_template||[]).push([[78616],{78616:(V,p,a)=>{a.r(p),a.d(p,{MaintenanceModule:()=>j});var s=a(81180),g=a(12236),v=a(47530),C=a(41840),d=a(44328);const x=function Z(t){return function(o){return null==t?void 0:t[o]}}({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});var L=a(14471),f=/[&<>"']/g,T=RegExp(f.source);var N=a(64716),e=a(99468),S=a(98547),h=a(96814),b=a(14647),W=a(68989),O=a(3291),R=a(83410);function z(t,o){if(1&t){const c=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(){e.CHM(c);const i=e.oxw();return e.KtG(i.sendNewVersionAvailableNotification())}),e._uU(1),e.ALo(2,"localize"),e.qZA()}2&t&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"SendNewVersionNotification")," "))}function F(t,o){if(1&t){const c=e.EpF();e.TgZ(0,"button",22),e.NdJ("click",function(){e.CHM(c);const i=e.oxw();return e.KtG(i.clearAllCaches())}),e._UZ(1,"i",23),e._uU(2),e.ALo(3,"localize"),e.qZA()}2&t&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"ClearAll")," "))}function H(t,o){if(1&t){const c=e.EpF();e.TgZ(0,"tr")(1,"td")(2,"span"),e._uU(3),e.qZA(),e.TgZ(4,"button",24),e.NdJ("click",function(){const l=e.CHM(c).$implicit,r=e.oxw();return e.KtG(r.clearCache(l.name))}),e._uU(5),e.ALo(6,"localize"),e.qZA()()()}if(2&t){const c=o.$implicit;e.xp6(3),e.Oqu(c.name),e.xp6(2),e.hij(" ",e.lcZ(6,2,"Clear")," ")}}function U(t,o){if(1&t&&(e.TgZ(0,"span",25)(1,"span"),e._uU(2),e.qZA(),e._uU(3),e.qZA()),2&t){const c=o.$implicit,n=e.oxw();e.xp6(1),e.Tol(n.getLogClass(c)),e.xp6(1),e.Oqu(n.getLogType(c)),e.xp6(1),e.hij(" ",n.getRawLogContent(c)," ")}}const J=[{path:"",component:(()=>{var t;class o extends C.c{constructor(n,i,l,r,u){super(n),(0,s.Z)(this,"_cacheService",void 0),(0,s.Z)(this,"_webLogService",void 0),(0,s.Z)(this,"_fileDownloadService",void 0),(0,s.Z)(this,"_notificationService",void 0),(0,s.Z)(this,"loading",!1),(0,s.Z)(this,"caches",null),(0,s.Z)(this,"canClearAllCaches",!1),(0,s.Z)(this,"logs",""),(0,s.Z)(this,"downloadWebLogs",function(){const m=this;m._webLogService.downloadWebLogs().subscribe(B=>{m._fileDownloadService.downloadTempFile(B)})}),this._cacheService=i,this._webLogService=l,this._fileDownloadService=r,this._notificationService=u}sendNewVersionAvailableNotification(){abp.message.confirm(this.l("SendNewVersionNotificationWarningMessage"),null,n=>{n&&this._notificationService.createNewVersionReleasedNotification().subscribe(i=>{abp.notify.info(this.l("SuccessfullySentNewVersionNotification"))})})}getCaches(){const n=this;n.loading=!0,n._cacheService.getAllCaches().pipe((0,N.x)(()=>{n.loading=!1})).subscribe(i=>{n.caches=i.items})}clearCache(n){const i=this,l=new d.IRy;l.id=n,i._cacheService.clearCache(l).subscribe(()=>{i.notify.success(i.l("CacheSuccessfullyCleared"))})}clearAllCaches(){const n=this;n._cacheService.clearAllCaches().subscribe(()=>{n.notify.success(n.l("AllCachesSuccessfullyCleared"))})}getWebLogs(){const n=this;n._webLogService.getLatestWebLogs().subscribe(i=>{n.logs=i.latestWebLogLines,n.fixWebLogsPanelHeight()})}setCanClearAllCaches(){this._cacheService.canClearAllCaches().subscribe(n=>{this.canClearAllCaches=n})}getLogClass(n){return n.startsWith("DEBUG")?"badge badge-dark":n.startsWith("INFO")?"badge badge-info":n.startsWith("WARN")?"badge badge-warning":n.startsWith("ERROR")||n.startsWith("FATAL")?"badge badge-danger":""}getLogType(n){return n.startsWith("DEBUG")?"DEBUG":n.startsWith("INFO")?"INFO":n.startsWith("WARN")?"WARN":n.startsWith("ERROR")?"ERROR":n.startsWith("FATAL")?"FATAL":""}getRawLogContent(n){return function w(t){return(t=(0,L.Z)(t))&&T.test(t)?t.replace(f,x):t}(n).replace("DEBUG","").replace("INFO","").replace("WARN","").replace("ERROR","").replace("FATAL","")}fixWebLogsPanelHeight(){let n=document.getElementsByClassName("full-height")[0];const i=document.body.clientHeight,l=n.clientHeight;n.style.height=l+(i-l)-420+"px"}onResize(n){this.fixWebLogsPanelHeight()}ngOnInit(){const n=this;n.getCaches(),n.getWebLogs(),n.setCanClearAllCaches()}}return t=o,(0,s.Z)(o,"\u0275fac",function(n){return new(n||t)(e.Y36(e.zs3),e.Y36(d.riO),e.Y36(d.jf7),e.Y36(S._),e.Y36(d.IMf))}),(0,s.Z)(o,"\u0275cmp",e.Xpm({type:t,selectors:[["ng-component"]],features:[e.qOj],decls:44,vars:30,consts:[[3,"resize"],[3,"title"],["role","actions"],["id","SendNewVersionNotification","class","btn btn-primary",3,"click",4,"ngIf"],[1,"card","card-custom","gutter-b"],[1,"card-body"],[3,"heading"],[1,"row","m-3"],[1,"col-xl-6"],[1,"mt-5"],[1,"col-xl-6","text-end"],["class","btn btn-primary float-end",3,"click",4,"ngIf"],[1,"col-xl-12"],[1,"table","table-striped","table-hover","table-bordered"],[4,"ngFor","ngForOf"],[1,"btn","btn-secondary","me-2",3,"click"],[1,"fa","fa-download"],[1,"btn","btn-primary",3,"click"],[1,"fa","fa-sync"],[1,"web-log-view","full-height"],["class","log-line",4,"ngFor","ngForOf"],["id","SendNewVersionNotification",1,"btn","btn-primary",3,"click"],[1,"btn","btn-primary","float-end",3,"click"],[1,"fa","fa-recycle"],[1,"btn","btn-primary","btn-sm","pull-right",3,"click"],[1,"log-line"]],template:function(n,i){1&n&&(e.TgZ(0,"div",0),e.NdJ("resize",function(r){return i.onResize(r)},!1,e.Jf7),e.TgZ(1,"sub-header",1),e.ALo(2,"localize"),e.TgZ(3,"div",2),e.YNc(4,z,3,3,"button",3),e.ALo(5,"permission"),e.qZA()(),e.TgZ(6,"div")(7,"div",4)(8,"div",5)(9,"tabset")(10,"tab",6),e.ALo(11,"localize"),e.TgZ(12,"div",7)(13,"div",8)(14,"p",9),e._uU(15),e.ALo(16,"localize"),e.qZA()(),e.TgZ(17,"div",10),e.YNc(18,F,4,3,"button",11),e.qZA()(),e.TgZ(19,"div",7)(20,"div",12)(21,"table",13)(22,"tbody"),e.YNc(23,H,7,4,"tr",14),e.qZA()()()()(),e.TgZ(24,"tab",6),e.ALo(25,"localize"),e.TgZ(26,"div",7)(27,"div",8)(28,"p",9),e._uU(29),e.ALo(30,"localize"),e.qZA()(),e.TgZ(31,"div",10)(32,"button",15),e.NdJ("click",function(){return i.downloadWebLogs()}),e._UZ(33,"i",16),e._uU(34),e.ALo(35,"localize"),e.qZA(),e.TgZ(36,"button",17),e.NdJ("click",function(){return i.getWebLogs()}),e._UZ(37,"i",18),e._uU(38),e.ALo(39,"localize"),e.qZA()()(),e.TgZ(40,"div",7)(41,"div",12)(42,"div",19),e.YNc(43,U,4,4,"span",20),e.qZA()()()()()()()()()),2&n&&(e.Q6J("@routerTransition",void 0),e.xp6(1),e.Q6J("title",e.lcZ(2,14,"Maintenance")),e.xp6(3),e.Q6J("ngIf",e.lcZ(5,16,"Pages_Administration_NewVersion_Create")),e.xp6(2),e.Tol(i.containerClass),e.xp6(4),e.MGl("heading"," ",e.lcZ(11,18,"Caches"),""),e.xp6(5),e.Oqu(e.lcZ(16,20,"CachesHeaderInfo")),e.xp6(3),e.Q6J("ngIf",i.canClearAllCaches),e.xp6(5),e.Q6J("ngForOf",i.caches),e.xp6(1),e.s9C("heading",e.lcZ(25,22,"WebSiteLogs")),e.xp6(5),e.Oqu(e.lcZ(30,24,"WebSiteLogsHeaderInfo")),e.xp6(5),e.hij(" ",e.lcZ(35,26,"DownloadAll")," "),e.xp6(4),e.hij(" ",e.lcZ(39,28,"Refresh")," "),e.xp6(5),e.Q6J("ngForOf",i.logs))},dependencies:[h.sg,h.O5,b.wW,b.AH,W.$,O.F,R.a],styles:[".web-log-view[_ngcontent-%COMP%]{font-family:Courier New;overflow-x:scroll;overflow-y:scroll;height:100%;white-space:nowrap}.web-log-view[_ngcontent-%COMP%]   span.log-line[_ngcontent-%COMP%]{margin-bottom:5px;display:block}.web-log-view[_ngcontent-%COMP%]   span.log-line[_ngcontent-%COMP%]   span.label[_ngcontent-%COMP%]{width:50px;display:inline-block}"],data:{animation:[(0,v.MH)()]}})),o})(),pathMatch:"full"}];let E=(()=>{var t;class o{}return t=o,(0,s.Z)(o,"\u0275fac",function(n){return new(n||t)}),(0,s.Z)(o,"\u0275mod",e.oAB({type:t})),(0,s.Z)(o,"\u0275inj",e.cJS({imports:[g.Bz.forChild(J),g.Bz]})),o})();var I=a(8387),P=a(40031);let j=(()=>{var t;class o{}return t=o,(0,s.Z)(o,"\u0275fac",function(n){return new(n||t)}),(0,s.Z)(o,"\u0275mod",e.oAB({type:t})),(0,s.Z)(o,"\u0275inj",e.cJS({imports:[P.o,I.g,E]})),o})()}}]);