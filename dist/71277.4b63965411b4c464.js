"use strict";(self.webpackChunkabp_zero_template=self.webpackChunkabp_zero_template||[]).push([[71277],{71277:(F,l,r)=>{r.r(l),r.d(l,{UpgradeModule:()=>C});var t=r(81180),g=r(40031),v=r(91860),u=r(12236),P=r(47530),f=r(41840),p=r(44328),m=r(15047),e=r(99468),T=r(70183),b=r(78812),y=r(96814),h=r(56223),Z=r(3291);function S(i,a){1&i&&(e.TgZ(0,"div")(1,"div",10)(2,"label",11),e._uU(3),e.ALo(4,"localize"),e.qZA()()()),2&i&&(e.xp6(3),e.hij(" ",e.lcZ(4,1,"RecurringSubscriptionUpgradeNote")," "))}function U(i,a){if(1&i&&(e.TgZ(0,"div")(1,"div",10)(2,"label",12),e._uU(3),e.ALo(4,"localize"),e.qZA(),e.TgZ(5,"div",13)(6,"p",14),e._uU(7),e.ALo(8,"number"),e.qZA()()()()),2&i){const s=e.oxw(2);e.xp6(3),e.hij(" ",e.lcZ(4,3,"Total")," "),e.xp6(4),e.AsE(" ",s.appSession.application.currencySign,"",e.xi3(8,5,s.additionalPrice,"1.2-2")," ")}}function A(i,a){if(1&i){const s=e.EpF();e.TgZ(0,"button",15),e.NdJ("click",function(){const d=e.CHM(s).$implicit,c=e.oxw(2);return e.KtG(c.checkout(d.gatewayType))}),e._uU(1),e.ALo(2,"localize"),e.qZA()}if(2&i){const s=a.$implicit,n=e.oxw(2);e.xp6(1),e.hij(" ",e.lcZ(2,1,"CheckoutWith"+n.getPaymentGatewayType(s.gatewayType))," ")}}function w(i,a){if(1&i&&(e.TgZ(0,"div",1)(1,"div",2)(2,"h3",3),e._uU(3),e.ALo(4,"localize"),e.qZA()(),e.TgZ(5,"form",4)(6,"h4",5),e._uU(7),e.ALo(8,"localize"),e.qZA(),e._UZ(9,"div",6),e.YNc(10,S,5,3,"div",7),e.YNc(11,U,9,8,"div",7),e.TgZ(12,"div",8),e.YNc(13,A,3,3,"button",9),e.qZA()()()),2&i){const s=e.oxw();e.Q6J("@routerTransition",void 0),e.xp6(3),e.hij(" ",e.lcZ(4,6,"PaymentInfo")," "),e.xp6(4),e.hij(" ",e.xi3(8,8,"Upgrade_Edition_Description",s.edition.displayName)," "),e.xp6(3),e.Q6J("ngIf",s.hasRecurringSubscription()),e.xp6(1),e.Q6J("ngIf",!s.hasRecurringSubscription()),e.xp6(2),e.Q6J("ngForOf",s.paymentGateways)}}const x=[{path:"",component:(()=>{var i;class a extends f.c{constructor(n,o,d,c,I,_,M){super(n),(0,t.Z)(this,"_router",void 0),(0,t.Z)(this,"_paymentHelperService",void 0),(0,t.Z)(this,"_activatedRoute",void 0),(0,t.Z)(this,"_paymentAppService",void 0),(0,t.Z)(this,"_tenantRegistrationAppService",void 0),(0,t.Z)(this,"_editionHelperService",void 0),(0,t.Z)(this,"subscriptionPaymentType",p.Ykt),(0,t.Z)(this,"subscriptionStartType",p.gPM),(0,t.Z)(this,"editionPaymentType",void 0),(0,t.Z)(this,"edition",new p._6E),(0,t.Z)(this,"tenantId",abp.session.tenantId),(0,t.Z)(this,"subscriptionPaymentGateway",p.UWJ),(0,t.Z)(this,"paymentPeriodType",void 0),(0,t.Z)(this,"additionalPrice",void 0),(0,t.Z)(this,"upgradeEditionId",void 0),(0,t.Z)(this,"editionPaymentTypeCheck",p.qLZ),(0,t.Z)(this,"paymentGateways",void 0),(0,t.Z)(this,"showPaymentForm",!1),this._router=o,this._paymentHelperService=d,this._activatedRoute=c,this._paymentAppService=I,this._tenantRegistrationAppService=_,this._editionHelperService=M}ngOnInit(){this.showMainSpinner(),this.editionPaymentType=parseInt(this._activatedRoute.snapshot.queryParams.editionPaymentType),this.upgradeEditionId=this._activatedRoute.snapshot.queryParams.upgradeEditionId,this.appSession.tenant.edition.isFree?this._tenantRegistrationAppService.getEdition(this.upgradeEditionId).subscribe(n=>{this._editionHelperService.isEditionFree(n)?this._paymentAppService.switchBetweenFreeEditions(n.id).subscribe(()=>{this.hideMainSpinner(),this._router.navigate(["app/admin/subscription-management"])}):(this.hideMainSpinner(),this.redirectToBuy())}):this._paymentAppService.hasAnyPayment().subscribe(n=>{if(!n)return this.hideMainSpinner(),void this.redirectToBuy();this._paymentAppService.getPaymentInfo(this.upgradeEditionId).subscribe(o=>{this.edition=o.edition,this.additionalPrice=Number(o.additionalPrice.toFixed(2)),this.additionalPrice<m.g.MinimumUpgradePaymentAmount?this._paymentAppService.upgradeSubscriptionCostsLessThenMinAmount(this.upgradeEditionId).subscribe(()=>{this.spinnerService.hide(),this.showPaymentForm=!0,this._router.navigate(["app/admin/subscription-management"])}):(this.spinnerService.hide(),this.showPaymentForm=!0)}),this._paymentAppService.getLastCompletedPayment().subscribe(o=>{let d=new p.X$y;d.gatewayType=o.gateway,d.supportsRecurringPayments=!0,this.paymentGateways=[d],this.paymentPeriodType=o.paymentPeriodType,this.appSession.tenant.subscriptionPaymentType===this.subscriptionPaymentType.Manual&&this._paymentAppService.getActiveGateways(void 0).subscribe(c=>{this.paymentGateways=c})})})}checkout(n){let o=new p.LQI;o.editionId=this.edition.id,o.editionPaymentType=this.editionPaymentType,o.paymentPeriodType=this.paymentPeriodType,o.recurringPaymentEnabled=this.hasRecurringSubscription(),o.subscriptionPaymentGatewayType=n,o.successUrl=m.g.remoteServiceBaseUrl+"/api/services/app/payment/"+this._paymentHelperService.getEditionPaymentType(this.editionPaymentType)+"Succeed",o.errorUrl=m.g.remoteServiceBaseUrl+"/api/services/app/payment/PaymentFailed",this._paymentAppService.createPayment(o).subscribe(d=>{this._router.navigate(["account/"+this.getPaymentGatewayType(n).toLocaleLowerCase()+"-purchase"],{queryParams:{paymentId:d,isUpgrade:!0,redirectUrl:"app/admin/subscription-management"}})})}getPaymentGatewayType(n){return this._paymentHelperService.getPaymentGatewayType(n)}hasRecurringSubscription(){return this.appSession.tenant.subscriptionPaymentType!==this.subscriptionPaymentType.Manual}redirectToBuy(){this._router.navigate(["account/buy"],{queryParams:{tenantId:this.appSession.tenant.id,editionPaymentType:p.qLZ.BuyNow,editionId:this.upgradeEditionId,subscriptionStartType:this.subscriptionStartType.Paid}})}}return i=a,(0,t.Z)(a,"\u0275fac",function(n){return new(n||i)(e.Y36(e.zs3),e.Y36(u.F0),e.Y36(T.T),e.Y36(u.gz),e.Y36(p.KC),e.Y36(p.Zr1),e.Y36(b.Y))}),(0,t.Z)(a,"\u0275cmp",e.Xpm({type:i,selectors:[["ng-component"]],features:[e.qOj],decls:1,vars:1,consts:[["class","login-form",4,"ngIf"],[1,"login-form"],[1,"pb-13","pt-lg-0","pt-5"],[1,"fw-bolder","text-dark","fs-h4","fs-h1-lg"],["method","post",1,"login-form","form"],[1,"mb-2"],[1,"separator","separator-border-dashed"],[4,"ngIf"],[1,"pb-lg-0","pb-5"],["class","btn btn-success w-100",3,"click",4,"ngFor","ngForOf"],[1,"mb-5","row"],[1,"col-sm-12"],[1,"col-sm-8"],[1,"col-sm-4","text-end"],["id","totalPrice",1,"fw-bolder"],[1,"btn","btn-success","w-100",3,"click"]],template:function(n,o){1&n&&e.YNc(0,w,14,11,"div",0),2&n&&e.Q6J("ngIf",o.showPaymentForm)},dependencies:[y.sg,y.O5,h._Y,h.JL,h.F,y.JJ,Z.F],encapsulation:2,data:{animation:[(0,P.RP)()]}})),a})(),pathMatch:"full"}];let E=(()=>{var i;class a{}return i=a,(0,t.Z)(a,"\u0275fac",function(n){return new(n||i)}),(0,t.Z)(a,"\u0275mod",e.oAB({type:i})),(0,t.Z)(a,"\u0275inj",e.cJS({imports:[u.Bz.forChild(x),u.Bz]})),a})(),C=(()=>{var i;class a{}return i=a,(0,t.Z)(a,"\u0275fac",function(n){return new(n||i)}),(0,t.Z)(a,"\u0275mod",e.oAB({type:i})),(0,t.Z)(a,"\u0275inj",e.cJS({imports:[g.o,v.y,E]})),a})()}}]);